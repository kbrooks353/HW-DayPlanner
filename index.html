<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <title>Work Day Scheduler</title>
</head>

<body>
    <header class="jumbotron">
        <h1 class="display-3">Work Day Scheduler</h1>
        <p class="lead">A simple calendar app for scheduling your work day</p>
        <p id="currentDay" class="lead"></p>
    </header>
    <div class="container">
        <!-- Timeblocks go here -->
        <div class="row">
            <div class="hour" id="9">9am</div>
            <textarea name="9am" id="9"></textarea>
            <button class="saveBtn" type="submit" id="btn9am"></button>
        </div>
        <div class="row">
            <div class="hour" id="10">10am</div>
            <textarea name="10am" id="10"></textarea>
            <button class="saveBtn" type="submit" id="btn10am"></button>
        </div>
        <div class="row">
            <div class="hour" id="11">11am</div>
            <textarea name="11am" id="11"></textarea>
            <button class="saveBtn" type="submit" id="btn11am"></button>
        </div>
        <div class="row">
            <div class="hour" id="12">12pm</div>
            <textarea name="12pm" id="12"></textarea>
            <button class="saveBtn" type="submit" id="btn12pm"></button>
        </div>
        <div class="row">
            <div class="hour" id="13">1pm</div>
            <textarea name="1pm" id="13"></textarea>
            <button class="saveBtn" type="submit" id="btn1pm"></button>
        </div>
        <div class="row">
            <div class="hour" id="14">2pm</div>
            <textarea name="2pm" id="14"></textarea>
            <button class="saveBtn" type="submit" id="btn2pm"></button>
        </div>
        <div class="row">
            <div class="hour" id="15">3pm</div>
            <textarea name="3pm" id="15"></textarea>
            <button class="saveBtn" type="submit" id="btn3pm"></button>
        </div>
        <div class="row">
            <div class="hour" id="16">4pm</div>
            <textarea name="4pm" id="16"></textarea>
            <button class="saveBtn" type="submit" id="btn4pm"></button>
        </div>
        <div class="row">
            <div class="hour" id="17">5pm</div>
            <textarea name="5pm" id="17"></textarea>
            <button class="saveBtn" type="submit" id="btn5pm"></button>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>


    <script>
        $(document).ready(function () {
            startClock();
            beforeAfter();
            var inputArray = [];
            $(".saveBtn").on("click", function (event) {
                event.preventDefault();
                var whichBtn = $(this).attr("id").replace("btn", "");
                console.log(whichBtn);
                var whichTxtArea = $("textarea[name=" + whichBtn + "]");
                console.log(whichTxtArea);
                var whichTxtAreaInput = $("textarea[name=" + whichBtn + "]").val();
                $(whichTxtArea).text(whichTxtAreaInput);

                
                inputArray.push(whichTxtAreaInput);
                console.log(inputArray);

                // stores input in local storage overrides what was previously stored
                localStorage.setItem("events", JSON.stringify(inputArray));            
            });

            function startClock() {
                setInterval(function () {
                    // TODO: use moment to get current time and store it in a variable
                    // named currentTime.
                    var currentTime = moment();
                    // TODO: update the text of $currentTimeElem to be currentTime formatted to:
                    // Hours:Minutes:Seconds AM/PM
                    $("#currentDay").html(currentTime.format("dddd, MMMM Do YYYY, h:mm:ss a"))
                }, 1000)
            }

            // set background based on time of day
            function beforeAfter() {

                var format = "HH:mm:ss";
                var format2 = "HH";
                var currentTimeHours = moment().format(format);
                console.log(currentTimeHours);
                function hourStringify(hour) {
                    // invalid cases return 00
                    if (hour <= 0 || hour >= 24) {
                        return "00:00:00";
                    }
                    // if it's less than ten add a 0 in front
                    if (hour < 10) {
                        return "0" + hour + ":00:00";
                    }
                    // otherwise just add the end :00:00 to the number
                    return hour + ":00:00";
                }
                var hourDivs = $("textarea");
                for (var i = 0; i < hourDivs.length; i++) {
                    var hourText = hourDivs[i].getAttribute("id");
                    // take current hours and make it format2
                    var currentHours = moment(currentTimeHours, format2);
                    console.log(currentHours);
                    
                    // take the id of the textarea and make it into an hour string 
                    var checkTime = hourStringify(hourText);
                    // take the checkTime and make it a moment format
                    var timeToCheck = moment(checkTime, format);
                    // compare hours and set the background of each textarea
                    if (timeToCheck.isBefore(currentHours)) {
                        $(hourDivs[i]).attr("class", "past");
                    }else if (timeToCheck.isSame(currentHours)){
                        $(hourDivs[i]).attr("class", "present");
                    }else {
                        $(hourDivs[i]).attr("class", "future");
                    }
                }


            }



        });
    </script>




</body>

</html>